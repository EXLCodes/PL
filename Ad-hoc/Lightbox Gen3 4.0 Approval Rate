/**************** Initial *****************/
with base_data as (
    select di.target_id
         , di.DATE_OF_UNDERWRITING
         , di.UW_RESULT:applicationDecisionInfo:decisionSegment::string                                              as decisionSegment
         , try_cast(di.UW_RESULT:applicationDecisionInfo.projectedUbti::string as float)                             as UBTI
         , try_cast(di.UW_RESULT:applicationDecisionInfo:individualDecisionInfos[0]:underwritingFico::string as int) as uw_fico
         , try_cast(di.UW_REQUEST:application:applicantsList[0]:gen3Score::string as int)                            as gen3_score
         , di.UW_REQUEST:application:rateLockWorkflowVersion::string                                                 as rateLockWorkflowVersion
         , di.UW_RESULT:applicationDecisionInfo:decision::string                                                     as di_decision
         , di.uw_Request:application:plLoanUse::string                                                               as pl_use
         , try_cast(di.uw_Result:applicationDecisionInfo:combinedTierNumber::string as int)                          as tier
    from TDM_UNDERWRITING.CLEANSED.DIODES_OFFICIAL di
    where di.UW_REQUEST:application:rateLockType::string = 'LIGHTBOX'
      and di.DATE_OF_UNDERWRITING >= '2023-06-05'
      and di.TARGET_ID in (
          '24376388',	'24377663',	'24357220',	'24337176',	'24381361',	'24384373',	'24375133',	'24375475',	'24316743',	'24388569',	'24319987',	'24398740',	'24399850',	'24360656',	'24359742',	'24398948',	'24380114',	'24405472',	'24313322',	'24419916',	'24309421',	'24364568',	'24413743',	'24363823',	'24350508',	'24340979',	'24406222',	'24394606',	'24409037',	'24307079',	'24396650',	'24375715',	'24363696',	'24338904',	'24312411',	'24411751',	'24419861',	'24369980',	'24337462',	'24396241',	'24407634',	'24326445',	'24340746',	'24333779',	'24349559',	'24329868',	'24385061',	'24383953',	'24306379',	'24385100',	'24342617',	'24409416',	'24347233',	'24404758',	'24413666',	'24391285',	'24388113',	'24315110',	'24312786',	'24309602',	'24374839',	'24321179',	'24399895',	'24407887',	'24376183',	'24410875',	'24411620',	'24370687',	'24411107',	'24341045',	'24319603',	'24383765',	'24414637',	'24376104',	'24421977',	'24368392',	'24305040',	'24302844',	'24372465',	'24306316',	'24354930',	'24400391',	'24363119',	'24360258',	'24389582',	'24361492',	'24384660',	'24341385',	'24330570',	'24421096',	'24309425',	'24327392',	'24380050',	'24344501',	'24398867',	'24387405',	'24365977',	'24370296',	'24382218',	'24304015',	'24384319',	'24342866',	'24339423',	'24343709',	'24395652',	'24411403',	'24404542',	'24318199',	'24378719',	'24319019',	'24350647',	'24379579',	'24362291',	'24322056',	'24405391',	'24402895',	'24407218',	'24414156',	'24413886',	'24416126',	'24351681',	'24361082',	'24313664',	'24404238',	'24306667',	'24352636',	'24323725',	'24360556',	'24357731',	'24318485',	'24416710',	'24366325',	'24361484',	'24339229',	'24414363',	'24311517',	'24365048',	'24313050',	'24368628',	'24421723',	'24317736',	'24312795',	'24329196',	'24340361',	'24356782',	'24366910',	'24352719',	'24307648',	'24328618',	'24339091',	'24304962',	'24309034',	'24308959',	'24382517',	'24406494',	'24359408',	'24361944',	'24324588',	'24333463',	'24337584',	'24385073',	'24365810',	'24395268',	'24304991',	'24333012',	'24347000',	'24379893',	'24411912',	'24392831',	'24402817',	'24337841',	'24367449',	'24353335',	'24379858',	'24366489',	'24410390',	'24352358',	'24379898',	'24356356',	'24356646',	'24311811',	'24374530',	'24381010',	'24357842',	'24382821',	'24382341',	'24337766',	'24308393',	'24362962',	'24414942',	'24414648',	'24381028',	'24356617',	'24360228',	'24363384',	'24346127',	'24305718',	'24303807',	'24330367',	'24418598',	'24305637',	'24380765',	'23163554',	'24320539',	'24307905',	'24402175',	'24421936',	'24362956',	'24346264',	'24378468',	'24410735',	'24346047',	'24417745',	'24409652',	'24317454',	'24333434',	'24395992',	'24305780',	'24313063',	'24308864',	'24307302',	'24319587',	'24339738',	'24397950',	'24383017',	'24412680',	'24319599',	'24340944',	'24350242',	'24356373',	'23194362',	'24318759',	'24354230',	'24310025',	'24342585',	'24344355',	'24334183',	'24345788',	'24343976',	'24374586',	'24368281',	'24366459',	'24332647',	'24357573',	'24371492',	'24356415',	'24379714',	'24305234',	'24314864',	'24419276',	'24402244',	'24346650',	'24306089',	'24413179',	'24422022',	'24358494',	'24312750',	'24336949',	'24312898',	'24305610',	'24398983',	'24416671',	'24419921',	'24356365',	'23975536',	'24349060',	'24334556',	'24316479',	'24316640',	'24383123',	'24336512',	'24382124',	'24407197',	'24334493',	'24407555',	'24341918',	'24371500',	'24412388',	'24373982',	'24419160',	'24315911',	'24377295',	'24332895',	'24347862',	'24421602',	'24395498',	'24409927',	'24337800',	'24369511',	'24336355',	'24353121',	'24352360',	'24358532',	'24399648',	'24416610',	'24320061',	'24305802',	'24381495',	'24390293',	'24304024',	'24394215',	'24377440',	'24342808',	'24337950',	'24352624',	'24364190',	'24329034',	'24368374',	'24348935',	'24385497',	'24375970',	'24419136',	'24325837',	'24342574',	'24374466',	'24309913',	'24380630',	'24350911',	'24331784',	'24356156',	'24356630',	'24348692',	'24411438',	'24312182',	'24373117',	'24415113',	'24377277',	'24321289',	'24383599',	'24324979',	'24310020',	'24401753',	'24307990',	'24407500',	'24309703',	'24351919',	'24411707',	'24306737',	'24356545',	'24387568',	'24418940',	'24375393',	'24338696',	'24305616',	'24369035',	'24361423',	'24419050',	'24373631',	'24330208',	'24334523',	'24334604',	'24365723',	'24361094',	'24320669',	'24369171',	'24347270',	'24337352',	'24391707',	'24357696',	'24306263',	'24307921',	'24381337',	'24375092',	'24386907',	'24421889',	'24368457',	'24303195',	'24338336',	'24364805',	'24385394',	'24374136',	'24384320',	'24333152',	'24386849',	'24380938',	'24378878',	'24325327',	'24392394',	'24352009',	'24400211',	'24381072',	'24366804',	'24309744',	'24401427',	'24396347',	'24377782',	'24407246',	'24381040',	'24344795',	'24385406',	'24417367',	'24326812',	'24364460',	'24365111',	'24356080',	'24410672',	'24349759',	'24311491',	'24408263',	'24417288',	'24375010',	'24408842',	'24386674',	'24313413',	'24337192',	'24350082',	'24308728',	'24304849',	'24336051',	'24312160',	'24303806',	'24419681',	'24384450',	'24413273',	'24406327',	'24413639',	'24407801',	'24416586',	'24335316',	'24385097',	'24365899',	'24380343',	'24351547',	'24385417',	'24394871',	'24409486',	'24333828',	'24345641',	'24327653',	'24351114',	'24383679',	'24312679',	'24334293',	'24310874',	'24356806',	'24306525',	'24379735',	'24307522',	'24398969',	'24402015',	'24410659',	'24326933',	'24304097',	'24304436',	'24352847',	'24416875',	'24340434',	'24367954',	'24388984',	'24397366',	'24387010',	'24352240',	'24352610',	'24375425',	'24393162',	'24364276',	'24420670',	'24421348',	'24389096',	'24372086',	'24380934',	'24394957',	'24387886',	'24385579',	'24384133',	'24362374',	'24309884',	'24377190',	'24365692',	'24410315',	'24383048',	'24311255',	'24411804',	'24358062',	'24411137',	'24358864',	'24313344',	'24365794',	'24334781',	'24408491',	'24411541',	'24333854',	'24342715',	'24405712',	'24403967',	'24308074',	'24356662',	'24362234',	'24388938',	'24389036',	'24407675',	'24374477',	'24413855',	'24402929',	'24362322',	'24397444',	'24385705',	'24382266',	'24314229',	'24407830',	'24419041',	'24393315',	'24399935',	'24418179',	'24305933',	'24312769',	'24341713',	'24356350',	'23822586',	'24348688',	'24395149',	'24375523',	'24366475',	'24393623',	'24394377',	'24377220',	'24308901',	'24340805',	'24418491',	'24318086',	'24368096',	'24357065',	'24325370',	'24357392',	'24412777',	'24342721',	'24420512',	'24340373',	'24368055',	'24305632',	'24354066',	'24387307',	'24309030',	'24376026',	'24375718',	'24327069',	'24394809',	'24312997',	'24386735',	'24403557',	'24385338',	'24369344',	'24356004',	'24387126',	'24400306',	'24381760',	'24323251',	'24389285',	'24359156',	'24304183',	'24393866',	'24421911',	'24348917',	'24339973',	'24315239',	'24375756',	'24367610',	'24375030',	'24404026',	'24327195',	'24352087',	'24307578',	'24345890',	'24384064',	'24354151',	'24376955',	'24415354',	'24405201',	'24347181',	'24375719',	'24361057',	'24341244',	'24412897',	'24412703',	'24349349',	'24370908',	'24351256',	'24375050',	'24389180',	'24358453',	'24382704',	'24359662',	'24321166',	'24320702',	'24414155',	'24408135',	'24418512',	'24417007',	'24370336',	'24414429',	'24414135',	'24416447',	'24364946',	'24360661',	'24411057',	'24390573',	'24388705',	'24363386',	'24386029',	'24312588',	'24346059',	'24315917',	'24331984',	'24313033',	'24404019',	'24311705',	'24330333',	'24310130',	'24353482',	'24372662',	'24370836',	'24418273',	'24410989',	'24414710',	'24412872',	'24410486',	'24351117',	'24351321',	'24398836',	'24354454',	'24420880',	'24332174',	'24418738',	'24375576',	'24407922',	'24301426',	'24366353',	'24315652',	'24311900',	'24307440',	'24410404',	'24369399',	'24379132',	'24379114',	'24347430',	'24337516',	'24337786',	'24314283',	'24386288',	'24361293',	'24401270',	'24339864',	'24378384',	'24377959',	'24327166',	'24315460',	'24336895',	'24368691',	'24310843',	'24318235',	'24371874',	'24406233',	'24373314',	'24318136',	'24365156',	'24406265',	'24314593',	'24352830',	'24399082',	'24375040',	'24312213',	'24381205',	'24405152',	'24346505',	'24326639',	'24318884',	'24348650',	'24366478',	'24405875',	'24340511',	'24398440',	'24351605',	'24353029',	'24339111',	'24308575',	'24377002',	'24330836',	'24413432',	'24303794',	'24343446',	'24409598',	'24304541',	'24420027',	'24382568',	'24334299',	'24319414',	'24415044',	'24400805',	'24323702',	'24385302',	'24319513',	'24346531',	'24336635',	'24341461',	'24390761',	'24373221',	'24309238',	'24375892',	'24369491',	'24415985',	'24393699',	'24380327',	'24367656',	'24368891',	'24370865',	'24360915',	'24341635',	'24405880',	'24309746',	'24354355',	'24420873',	'24407714',	'24370069',	'24301713',	'24414993',	'24370196',	'24301991',	'24318412',	'24360990',	'24361368',	'24349692',	'24310173',	'24304400',	'24406177',	'24374690',	'24395923',	'24339438',	'24412977',	'24316861',	'24347859',	'24314422',	'24304901',	'24410841',	'24372818',	'24377094',	'24306971',	'24321483',	'24380089',	'24303648',	'24319706',	'24355163',	'24384808',	'24302072',	'24320200',	'24375573',	'24406017',	'24311171',	'24366744',	'24334083',	'24361009',	'24341959',	'24346574',	'24339954',	'24342665',	'24338832',	'24312903',	'24340933',	'24335746',	'24335679',	'24004109',	'24320768',	'24418425',	'24352209',	'24325045',	'24316906',	'24376803',	'24380072',	'24389041',	'24411266',	'24321615',	'24314710',	'24384280',	'24329623',	'24362438',	'24307105',	'24422032',	'24411673',	'24340711',	'24328767',	'24350179',	'24356090',	'24350232',	'24416252',	'24415429',	'24365549',	'24379843',	'24372639',	'24417312',	'24141345',	'24388217',	'24350954',	'24312131',	'24307262',	'24369857',	'24319721',	'24363349',	'24359461',	'24317556',	'24380113',	'24329885',	'24345626',	'24330703',	'24378173',	'24369571',	'24403942',	'24374210',	'24362223',	'24301718',	'24323657',	'24400193',	'24404961',	'24304346',	'24376767',	'24360102',	'24375037',	'24318534',	'24416059',	'24332146',	'24418005',	'24348248',	'24347101',	'24332386',	'24322713',	'24402243',	'24306381',	'24362136',	'24315718',	'24363683',	'24344661',	'24347422',	'24335539',	'24411273',	'24341182',	'24314448',	'24378561',	'24323407',	'24415915',	'24316964',	'24309170',	'24359387',	'24353716',	'24379726',	'24373211',	'24315296',	'24400976',	'24414092',	'24316842',	'24395930',	'24341290',	'24410472',	'24388743',	'24391950',	'24357951',	'24409627',	'24339781',	'24332090',	'24387071',	'24415471',	'24358885',	'24417546',	'24388747',	'24305224',	'24341017',	'24351576',	'24399002',	'24335151',	'24320034',	'24332671',	'24334089',	'24377871',	'24379045',	'24331367',	'24353194',	'24412116',	'24415579',	'24314075',	'24412618',	'24412708',	'24394426',	'24354990',	'24342033',	'23142364',	'24348915',	'24346367',	'24382115',	'24377677',	'24305011',	'24404795',	'24322751',	'24304771',	'24373181',	'24393902',	'24340619',	'24376871',	'24315538',	'24396224',	'24361761',	'24366260',	'24332487',	'24308398',	'24419409',	'24398564',	'24353362',	'24360105',	'24340741',	'24395114',	'24349054',	'24373076',	'24307428',	'23531516',	'24385167',	'24311913',	'24308746',	'24396503',	'24334946',	'24354186',	'24318484',	'24377468',	'24349154',	'24375838',	'24378209',	'24375435',	'24365677',	'24409370',	'24359385',	'24416287',	'24368197',	'24340811',	'24367737',	'24300171',	'24391958',	'24402288',	'24338417',	'24421036',	'24310294',	'24384298',	'24384706',	'24352028',	'24373063',	'24365868',	'22996057',	'24340450',	'24370400',	'24406179',	'24406655',	'24385006',	'24397695',	'24343609',	'24417707',	'24356912',	'24345545',	'24373271',	'24398846',	'24408839',	'24341697',	'24360774',	'24345314',	'24324482',	'24321082',	'24365199',	'24382209',	'24391649',	'24384209',	'24383624',	'24355715',	'24344081',	'24405135',	'24382412',	'24348274',	'24362360',	'23932983',	'24363308',	'24409435',	'24419653',	'24404353',	'24360704',	'24371417',	'24333651',	'24375610',	'24399547',	'24416005',	'24313062',	'24332197',	'24373574',	'24385460',	'24409546',	'24334216',	'24336502',	'24405068',	'24404724',	'24360735',	'24313935',	'24309489',	'24370953',	'24341332',	'24402247',	'24402481',	'24413778',	'24408571',	'24334620',	'24367942',	'24370363',	'24377365',	'24371246',	'24371900',	'24342689',	'24395560',	'24336708',	'24364136',	'24361835',	'24321536',	'24366434',	'24339260',	'24381377',	'24386806',	'23111104',	'24397609',	'24399822',	'24362519',	'24374635',	'24356083',	'24407334',	'24343647',	'24376339',	'24402530',	'24418830',	'24420007',	'24359456',	'24343821',	'24350342',	'24318232',	'24383528',	'24316305',	'24317922',	'24320173',	'24402893',	'24404884',	'24320678',	'24310408',	'24331469',	'24350024',	'24381192',	'24314538',	'24351140',	'24412952',	'24362121',	'24388150',	'24407669',	'24419424',	'24319060',	'24383674',	'24043141',	'24397314',	'24381672',	'24417131',	'24308770',	'24352257',	'24350824',	'24337991',	'24314132',	'24326075',	'24374036',	'24330443',	'24367852',	'24385243',	'24385541',	'24314819',	'24341600',	'24313635',	'24343591',	'23151049',	'24328912',	'24379937',	'24363184',	'24319374',	'24355432',	'24304215',	'24410646',	'24332843',	'24306573',	'24389201',	'24404619',	'24358637',	'24335440',	'24340475',	'24399620',	'24353245',	'24412704',	'24421320',	'24412991',	'24361742',	'24303358',	'24363758',	'24358212',	'24399743',	'24333853',	'24346911',	'24404394',	'24315245',	'24321224',	'24313309',	'24361072',	'24337368',	'24310251',	'24344164',	'24387480',	'24381398',	'24368873',	'24394673',	'24372126',	'24415131',	'24395432',	'24384554',	'24318563',	'24340121',	'24407407',	'18953292',	'24320382',	'24386105',	'24322496',	'24367814',	'24417491',	'24303389',	'24376717',	'24365253',	'24366518',	'24375594',	'24392745',	'24339914',	'24392654',	'24412619',	'24402280',	'24360423',	'24405661',	'24352628',	'24359601',	'24414867',	'24346775',	'24369940',	'24344580',	'24313464',	'24317475',	'24317788',	'24324467',	'24349436',	'24412540',	'24404322',	'24417959',	'23783721',	'24415468',	'24388850',	'24373569',	'24384995',	'24310073',	'24305925',	'24312045',	'24388193',	'23709201',	'24313904',	'24388314',	'24305603',	'24421054',	'24306794',	'24309047',	'24329253',	'24389523',	'24408851',	'24339297',	'24315381',	'24346856',	'24333975',	'24383471',	'24334403',	'24402156',	'24311265',	'24318982',	'24357636',	'24321837',	'24383703',	'24325477',	'24410363',	'24330988',	'24390563',	'24398498',	'24365925',	'24347500',	'24352896',	'24352558',	'24333148',	'24388825',	'24350357',	'24359736',	'24375162',	'24332449',	'24419152',	'24350076',	'24334039',	'24417199',	'24387305',	'24386334',	'24401260',	'24400663',	'24311807',	'24347230',	'24306409',	'24361865',	'24371367',	'24318516',	'24403724',	'24409973',	'24385858',	'24311848',	'24415357',	'24372043',	'24363232',	'24345171',	'24414516',	'24348738',	'24358123',	'24367297',	'24303529',	'24339799',	'24361300',	'24311635',	'24354759',	'24369046',	'24347179',	'24371808',	'24305798',	'24343558',	'24337618',	'24369829',	'24314694',	'24368368',	'24396195',	'24328866',	'24360521',	'24414317',	'24387736',	'24352314',	'24396207',	'24328473',	'24311385',	'24369533',	'24311588',	'24375592',	'24333262',	'24401269',	'24380888',	'24343841',	'24421844',	'24374908',	'24307832',	'24334498',	'24377195',	'24408587',	'24418528',	'24371254',	'24331827',	'24409279',	'24368760',	'24366027',	'24317256',	'24412881',	'24416731',	'24407993',	'24310268',	'24405381',	'24313367',	'24406208',	'23431050',	'24376179',	'24364702',	'24314414',	'24391595',	'24358758',	'24306990',	'24360152',	'24313363',	'24359580',	'24321337',	'24314411',	'24306470',	'24343939',	'24381763',	'24304274',	'24370256',	'24336665',	'24307792',	'24397845',	'24319026',	'24370434',	'24337048',	'24420038',	'24353705',	'24320256',	'24413915',	'24383745',	'24303687',	'24382227',	'24345020',	'24286890',	'24306572',	'24385473',	'24366810',	'24387561',	'24383967',	'24359795',	'24384225',	'24305285',	'24376248',	'24373213',	'24304985',	'24418623',	'24326920',	'24326190',	'24320452',	'24327173',	'24354157',	'24407437',	'24352618',	'24320903',	'24372424',	'24398363',	'24350058',	'24353748',	'24339443',	'24306761',	'24356765',	'24387742',	'24403529',	'24350623',	'24414181',	'24346838',	'24396566',	'24310221',	'24421925',	'24305728',	'24403788',	'24317837',	'24412577',	'24413877',	'24361553',	'24345200',	'24337210',	'24395008',	'24325366',	'24382776',	'24357593',	'24346393',	'24345002',	'24373693',	'24306005',	'24350154',	'24358133',	'24368710',	'24402159',	'24363505',	'24377488',	'24353083',	'24312481',	'24376499',	'24363674',	'24363724',	'24406593',	'24312179',	'24367979',	'24339253',	'24307304',	'24306666',	'24388990',	'24402177',	'24314721',	'24400212',	'24306678',	'24356938',	'24317291',	'24303700',	'24325095',	'24317453',	'24320185',	'24349366',	'24395332',	'24354288',	'24392750',	'24318933',	'24373853',	'24417989',	'24368649',	'23907137',	'24372653',	'24422026',	'23643142',	'24372538',	'24303524',	'24418476',	'24316502',	'24383636',	'24336001',	'24320927',	'24365335',	'24401739',	'24414345',	'24386174',	'24345632',	'24373447',	'24395194',	'24420885',	'24368127',	'24305788',	'24411480',	'24350840',	'24406106',	'24341957',	'24421398',	'24320872',	'24401080',	'24377311',	'24351033',	'24347631',	'24403226',	'24333519',	'24343311',	'24309789',	'24375959',	'24309970',	'24343899',	'24312791',	'24380587',	'24342296',	'24417261',	'24353524',	'24416079',	'24421873',	'24346321',	'24330898',	'24312497',	'24355106',	'24347167',	'24305453',	'24395041',	'24370749',	'24335701',	'24369870',	'24386272',	'24050108',	'24346452',	'24310897',	'24310177',	'24406114',	'24396630',	'24308623',	'24364578',	'24346013',	'24369672',	'24397687',	'24397800',	'24408318',	'24327509',	'23863314',	'24346098',	'24307227',	'24381127',	'24373827',	'24350908',	'24360632',	'24328886',	'24414346',	'24318113',	'24371332',	'24347135',	'24387024',	'24314608',	'24366894',	'24375862',	'24357859',	'24313611',	'24321932',	'24344361',	'24334259',	'24330685',	'24368378',	'24348276',	'24361547',	'24310385',	'24365761',	'24323243',	'24352093',	'24355787',	'23395687',	'24366695',	'24316984',	'24420128',	'24356035',	'24011353',	'23980711',	'24340113',	'24312570',	'24310205',	'24329900',	'24416636',	'24378749',	'24313448',	'24394052',	'24312599',	'24322860',	'24317588',	'24347498',	'24326452',	'24365423',	'24314831',	'24406129',	'24374170',	'24346625',	'24417950',	'24402459',	'24412214',	'24302816',	'23026819',	'24411231',	'24305778',	'24356930',	'24318680',	'24366205',	'24304819',	'24348988',	'24324177',	'24405878',	'24318386',	'24385906',	'24386187',	'24314376',	'24362450',	'24107456',	'24376320',	'24392245',	'24352605',	'24417451',	'24372727',	'24355045',	'24311868',	'24341403',	'24333927',	'24340556',	'24330124',	'24333823',	'24397002',	'24380040',	'24331217',	'24334185',	'24340314',	'24343232',	'24381776',	'24419351',	'23116863',	'24313707',	'23983267',	'24342116',	'24333020',	'24347804',	'24413689',	'24313750',	'24409240',	'24377599',	'24345305',	'24317509',	'24343630',	'24322878',	'24371201',	'24384465',	'24360694',	'24312713',	'24314577',	'24409021',	'24317381',	'24365457',	'24326562',	'24414114',	'24374934',	'24354309',	'24384277',	'24360239',	'24360178',	'24305181',	'24312231',	'24317546',	'24358978',	'24370575',	'24400370',	'24309885',	'24369705',	'24324036',	'24341180',	'24330209',	'24357072',	'24331228',	'24357598',	'24357749',	'24384078',	'24358237',	'24308426',	'24311247',	'24355291',	'24336073',	'24419857',	'24372777',	'24394026',	'24360192',	'24314546',	'24411871',	'24410584',	'24418268',	'24337367',	'24421049',	'24302923',	'24363095',	'24338221',	'24338619',	'24408577',	'24363016',	'24353989',	'24381819',	'24401788',	'24409540',	'24360060',	'24340940',	'24418834',	'24418633',	'24353367',	'24312738',	'24367133',	'24394338',	'24397633',	'24398925',	'24378655',	'24350444',	'24358705',	'24311235',	'24401324',	'24416534',	'24392419',	'24339797',	'24366854',	'24417729',	'24340023',	'24327946',	'24398644',	'24370590',	'24367185',	'24326300',	'24305354',	'24304114',	'24410753',	'24384352',	'24421404',	'24320188',	'24316737',	'24312148',	'24318004',	'24321408',	'24419224',	'24384754',	'24366533',	'24408208',	'24402276',	'24404581',	'24418912',	'24332298',	'24380598',	'24367344',	'24418329',	'24387327',	'24373657',	'24417602',	'24342305',	'24388582',	'24405160',	'24314952',	'24407816',	'23011875',	'24356438',	'24364827',	'24369918',	'24359442',	'24357377',	'24344124',	'24361915',	'24413506',	'24350685',	'24380321',	'24359886',	'24352891',	'24330572',	'24367934',	'24332424',	'24326440',	'24402319',	'23549536',	'24373441',	'24404737',	'24394044',	'24310680',	'24362922',	'24320005',	'24352069',	'24317319',	'24353956',	'24328287',	'24355338',	'24415987',	'24327834',	'24304751',	'24308675',	'24397770',	'24336318',	'24309273',	'24367336',	'24356307',	'24316124',	'24339701',	'23395528',	'24347692',	'24398278',	'24357493',	'24365690',	'24367361',	'24367285',	'24345337',	'24321577',	'24418921',	'24354532',	'24340794',	'24316541',	'23218606',	'24324433',	'24408141',	'24363944',	'24331310',	'24319534',	'24356086',	'24365049',	'24381464',	'24404937',	'24348852',	'24303925',	'24365055',	'24362061',	'24385131',	'24334670',	'24402950',	'24358862',	'24378998',	'24318010',	'24336237',	'24304394',	'24372146',	'24422015',	'24337346',	'24407225',	'24331532',	'24353267',	'24330328',	'24340089',	'24345847',	'24314633',	'24367348',	'24401708',	'24401055',	'24411149',	'24409795',	'24342011',	'24354860',	'24384595',	'24353636',	'24360913',	'24383256',	'24352740',	'24305231',	'24372170',	'24386916',	'24318350',	'24371588',	'24347763',	'24318146',	'24412801',	'24310735',	'24376255',	'24359842',	'24302693',	'24377654',	'24368325',	'24358120',	'24347509',	'24316037',	'24356828',	'24028191',	'24325309',	'24416001',	'24310812',	'24363054',	'24308283',	'24334809',	'24347444',	'24367876',	'24395598',	'23092806',	'24416670',	'24318685',	'24341365',	'24372391',	'24416492',	'24415441',	'24345694',	'24362430',	'24365993',	'24349185',	'24306511',	'24396506',	'24337199',	'24305370',	'24385231',	'24315614',	'24311737',	'24353316',	'24367080',	'24421942',	'24367034',	'24371166',	'24352483',	'24348787',	'24311773',	'24353259',	'24313876',	'24381368',	'24310136',	'24364459',	'21250170',	'24402008',	'24420474',	'24344012',	'24386188',	'24385727',	'24391003',	'24320158',	'24420389',	'24374765',	'24378401',	'24421991',	'24368228',	'24404520',	'24348060',	'24382653',	'24397728',	'24385024',	'24419377',	'24381934',	'24392898',	'24387958',	'24360516',	'24349495',	'24372942',	'24383825',	'24364694',	'24335818',	'24323455',	'24370646',	'24411805',	'24377375',	'24324996',	'24414458',	'24372242',	'24383195',	'24388417',	'24326386',	'24416615',	'24358564',	'24416845',	'24344319',	'24402589',	'24310560',	'24356391',	'24396568',	'24351112',	'24361920',	'24324771',	'24387764',	'24345361',	'24386971',	'24339963',	'24397751',	'24352047',	'24403344',	'24327121',	'24332812',	'24396711',	'24358801',	'24363182',	'24352777',	'24324473',	'24313167',	'24331551',	'24353051',	'24381440',	'24341220',	'24415997',	'24384961',	'24354418',	'24360579',	'24304491',	'24338997',	'24302611',	'24313389',	'24411640',	'24409511',	'24415858',	'24405940',	'24334632',	'24339776',	'24407493',	'24354627',	'24340647',	'24336300',	'24320836',	'24302668',	'24305935',	'24321444',	'24359645',	'24394591',	'24367166',	'24394995',	'24367117',	'24336139',	'24357693',	'24401555',	'24380898',	'24353629',	'24354127',	'24319704',	'24343586',	'24393357',	'24374835',	'24314967',	'24408329',	'24392233',	'24350071',	'24379112',	'24313771',	'24375285',	'24325753',	'24361911',	'24329806',	'24421364',	'24383585',	'24363722',	'24328182',	'24404404',	'24331591',	'24345603',	'24379967',	'24385982',	'24334450',	'24357096',	'24413315',	'24371468',	'24342306',	'24315547',	'24327237',	'24310324',	'24366130',	'24411900',	'24303206',	'24377792',	'24368062',	'24314604',	'24355427',	'24408658',	'24344707',	'24410895',	'24311578',	'24330602',	'24318879',	'24363212',	'24358140',	'24408464',	'24407416',	'24416938',	'24398736',	'24357833',	'24419342',	'24404425',	'24409766',	'24400093',	'24334697',	'24421409',	'24330865',	'23256968',	'24406312',	'24315817',	'24396964',	'24392760',	'24348444',	'24309295',	'24302656',	'24343052',	'24354563',	'24384115',	'24366868',	'24415068',	'24366721',	'24318738',	'24316716',	'24415134',	'24360160',	'24324418',	'24358359',	'24384853',	'24356188',	'24335039',	'24350944',	'24324336',	'24418160',	'24307955',	'24302815',	'24346671',	'24409467',	'24310304',	'24310081',	'24407718',	'24338663',	'24338289',	'24323989',	'24320216',	'24339471',	'24374297',	'24358824',	'24409926',	'24355485',	'24359956',	'24316520',	'24416687',	'24315123',	'24379969',	'24302800',	'24309618',	'24308070',	'24317930',	'24308115',	'24314071',	'24372628',	'24371580',	'24418050',	'24305567',	'24416174',	'24353603',	'24346245',	'24365194',	'24412136',	'24348926',	'23852924',	'24349263',	'24345093',	'24412184',	'24318735',	'24394324',	'24397461',	'24372880',	'24357217',	'24306653',	'24371490',	'24381562',	'24392544',	'24351773',	'24391670',	'24306251',	'24354741',	'24380102',	'24400941',	'24405608',	'24380328',	'24409455',	'24413461',	'24358974',	'24322309',	'24389091',	'23744029',	'24376551',	'24309314',	'24418453',	'24339662',	'24406619',	'24368977',	'24309952',	'24355880',	'24341579',	'24323538',	'24371430',	'24346607',	'24418762',	'24386436',	'24331249',	'22670735',	'24313760',	'24414761',	'24377780',	'24399493',	'24418871',	'24383551',	'24360843',	'24313786',	'24346683',	'24385288',	'24385386',	'24375112',	'24347712',	'24377323',	'24406268',	'24311535',	'24311432',	'24312571',	'24354469',	'24370436',	'24359375',	'24399482',	'24417064',	'24314629',	'24334588',	'24361335',	'24351971',	'24341070',	'24309412',	'24403655',	'24366134',	'24407258',	'24355288',	'24391196',	'24313425',	'24381503',	'24352810',	'24340540',	'24335693',	'24341743',	'24321544',	'24381305',	'24340168',	'24408201',	'24359765',	'24310314',	'24364436',	'24362362',	'24408778',	'24357238',	'24386443',	'24402449',	'24314253',	'24310716',	'24401381',	'24354013',	'23063090',	'24346968',	'24336486',	'24417843',	'24419647',	'24374319',	'24408652',	'24418087',	'24416590',	'24378278',	'24305497',	'24398300',	'24313490',	'24342444',	'24336092',	'24402480',	'24313618',	'24343495',	'24344406',	'24420708',	'24315272',	'24305561',	'24383708',	'24351682',	'24357691',	'24373786',	'24329943',	'24344870',	'24305816',	'24380779',	'24328311',	'24418008',	'24381952',	'24319650',	'24318913',	'24338953',	'24420918',	'24323903',	'24393566',	'24388983',	'24315830',	'24335791',	'24355154',	'24315778',	'24344185',	'24399762',	'24378494',	'24365995',	'24418439',	'24345056',	'24313262',	'24308538',	'24317577',	'24333606',	'24320053',	'24367556',	'24314082',	'24375292',	'24331116',	'24405302',	'24416862',	'24389145',	'24358581',	'24374460',	'24320510',	'24308931',	'24346064',	'24376004',	'24364321',	'24408625',	'24388041',	'24401921',	'24371365',	'24413345',	'24359179',	'24380062',	'24329847',	'24325678',	'24357567',	'24374537',	'24307046',	'24415155',	'24368162',	'24421302',	'24347610',	'24311252',	'24411117',	'24366324',	'24419851',	'24406132',	'24362682',	'24393285',	'24379611',	'24333973',	'24303068',	'24399632',	'24396879',	'24376208',	'24374861',	'24334889',	'24381034',	'24320322',	'24386821',	'24318227',	'24407074',	'24364539',	'24381354',	'24307841',	'24360625',	'24310776',	'24366116',	'24307001',	'24311985',	'24415062',	'24348817',	'24416393',	'24313759',	'24343205',	'24361200',	'24321454',	'24348891',	'24419903',	'24421269',	'24309998',	'24405872',	'24419081',	'24418116',	'24398618',	'24409117',	'24370356',	'24347418',	'24331881',	'24342792',	'24353691',	'24349497',	'24408767',	'24362022',	'23737135',	'24363785',	'24386373',	'24322897',	'24397868',	'24310932',	'24309481',	'24320257',	'24387131',	'24403634',	'24335536',	'24410311',	'24385784',	'24337668',	'24340488',	'24395153',	'24418210',	'24402099',	'24312014',	'24384023',	'24334978',	'24329807',	'24344911',	'23426042',	'24304578',	'24339070',	'24321122',	'24371894',	'24394436',	'24406629',	'24364738',	'24368863',	'24403189',	'24362064',	'24412705',	'24371769',	'24419953',	'23289126',	'24417549',	'24388881',	'24371337',	'24364925',	'24408734',	'24330282',	'24380523',	'24407046',	'24386979',	'24321495',	'24380744',	'24376869',	'24374431',	'24394886',	'24422119',	'24338618',	'24365638',	'24400795',	'24417762',	'24351219',	'24329592',	'24359186',	'24315897',	'24350849',	'24320165',	'24348518',	'24373925',	'24378723',	'24378790',	'24342654',	'23781518',	'24367367',	'24406953',	'24363876',	'24379815',	'24372207',	'24323318',	'24306346',	'24337960',	'24369070',	'24332180',	'24411092',	'24358412',	'24334171',	'24308674',	'24361495',	'24370634',	'24366560',	'24304727',	'24348283',	'24358748',	'24359289',	'24384472',	'24338763',	'24332156',	'24373417',	'24339164',	'24360775',	'24374825',	'24387563',	'24416192',	'24309000',	'24410605',	'24366208',	'24369435',	'24373411',	'24390765',	'24318314',	'23844444',	'24403761',	'24372482',	'24381454',	'23196344',	'24390800',	'24331863',	'24345334',	'24331270',	'24333183',	'24350322',	'24350221',	'24375376',	'24377979',	'24365349',	'24304980',	'24334409',	'24311735',	'24313861',	'24336888',	'24375832',	'24384795',	'24374801',	'24376151',	'24413342',	'24339126',	'24357743',	'24390781',	'24324341',	'24357972',	'24346326',	'24348754',	'24344962',	'24372767',	'24303448',	'24415412',	'24350317',	'24341084',	'24347817',	'24361134',	'24421797',	'24321261',	'24344749',	'24317465',	'24352958',	'24313599',	'24362177',	'24382676',	'24410089',	'24352306',	'24333541',	'24309979',	'24355454',	'24344652',	'24365558',	'24348998',	'24405976',	'24373889',	'24330512',	'24366739',	'24328370',	'24379524',	'24357959',	'24383138',	'24350928',	'24363544',	'24346681',	'24369166',	'24403250',	'24346172',	'24401203',	'24360611',	'24316646',	'24414340',	'24388015',	'24365539',	'24375228',	'24322280',	'24332762',	'24318324',	'24323813',	'24319265',	'24305077',	'24346517',	'24307082',	'24411769',	'24321484',	'24342448',	'24306558',	'24364572',	'24335031',	'24393745',	'24374232',	'24332279',	'24404695',	'24314869',	'24346975',	'24375231',	'24339139',	'24405385',	'24375409',	'24401652',	'24398160',	'24375705',	'24352870',	'24350290',	'24405721',	'24339762',	'24304294',	'24330452',	'24352748',	'24305140',	'24347149',	'24339354',	'24407343',	'24406424',	'24395342',	'24309895',	'24360683',	'24359748',	'24389231',	'24306506',	'24367606',	'24381861',	'24385543',	'24344243',	'24402816',	'24380889',	'24331006',	'24335412',	'24407204',	'24372345',	'24335359',	'24360622',	'24311137',	'24378134',	'24308986',	'24309096',	'24387184',	'23792574',	'24395260',	'24330460',	'24338314',	'24311731',	'24308654',	'24420991',	'24338678',	'24339121',	'24384041',	'23626035',	'24386268',	'24385450',	'24397558',	'24309164',	'24336778',	'24363300',	'24338879',	'24400713',	'24410718',	'24410560',	'24328793',	'24401756',	'24309771',	'24339338',	'24375295',	'24312317',	'24378159',	'24320033',	'24333817',	'24314065',	'24416139',	'24395211',	'24385684',	'24340599',	'24416115',	'24383662',	'24307818',	'24349732',	'24374346',	'24332440',	'24414689',	'24349178',	'24340909',	'24346197',	'24329342',	'24379377',	'24379361',	'24380351',	'24376677',	'24375078',	'24312068',	'24355092',	'24366934',	'24386777',	'24351107',	'24327369',	'24334578',	'24365563',	'24347643',	'24403164',	'24316196',	'24421740',	'24315588',	'24404923',	'24399813',	'24361418',	'24342238',	'24327619',	'24346931',	'24385169',	'24311459',	'24369545',	'24410689',	'24342560',	'24371400',	'24367060',	'24421065',	'24367137',	'24383524',	'24420844',	'24408334',	'24407979',	'24342884',	'24378318',	'24309153',	'24359170',	'24420048',	'24375157',	'24334364',	'24354225',	'24353963',	'24397912',	'24347919',	'24344482',	'24376226',	'24374473',	'24402698',	'24380474',	'24372163',	'24338818',	'24304340',	'24356291',	'24308871',	'24319063',	'24351458',	'24382474',	'24342161',	'24406971',	'24333826',	'24388323',	'24339304',	'24407975',	'24416499',	'24404018',	'24388244',	'24380467',	'24397245',	'24324295',	'24356237',	'24353201',	'24326398',	'24346739',	'24355831',	'24304062',	'24420073',	'24380855',	'24370469',	'24378349',	'24404658',	'24320177',	'24350725',	'24396677',	'24420011',	'24411627',	'24401929',	'24372382',	'24366300',	'24353382',	'23861638',	'24407642',	'24411390',	'24349023',	'24334360',	'24356679',	'24310611',	'24409033',	'24307930',	'24380671',	'24378731',	'24388227',	'24365305',	'24375767',	'24360861',	'24352794',	'24359463',	'24327495',	'24407169',	'22904045',	'24398915',	'24373215',	'24410957',	'24369685',	'24367431',	'24387104',	'24374848',	'24347706',	'24419007',	'24354440',	'24421640',	'24356760',	'24350768',	'24411814',	'24379091',	'24416331',	'24317230',	'24363088',	'24404674',	'24339367',	'24421756',	'24304430',	'24384301',	'24335382',	'24403538',	'24316634',	'24316482',	'24308657',	'24314033',	'24335127',	'24368948',	'24382602',	'24410900',	'24403183',	'24407278',	'24416603',	'24335978',	'24365703',	'24306411',	'24413946',	'24328252',	'24350049',	'24391143',	'24387291',	'24406866',	'24366031',	'24368936',	'24385653',	'24394558',	'24406158',	'24409618'
          )
)
select target_id,
       decisionSegment,
       UBTI,
       uw_fico                   as fico,
       gen3_score,
       di_decision               as decision,
       rateLockWorkflowVersion,
       case
           when UBTI is null then '01 Missing'
           when UBTI < 0 then '99 Negative'
           when UBTI <= 0.045 then '02 [0.00, 0.045]'
           when UBTI <= 0.11 then '03 (0.045, 0.11]'
           when UBTI <= 0.16 then '04 (0.11, 0.16]'
           when UBTI <= 0.22 then '05 (0.16, 0.22]'
           when UBTI <= 0.27 then '06 (0.22, 0.27]'
           when UBTI <= 0.34 then '07 (0.27, 0.34]'
           when UBTI <= 0.41 then '08 (0.34, 0.41]'
           when UBTI <= 0.51 then '09 (0.41, 0.51]'
           when UBTI <= 0.67 then '10 (0.51, 0.67]'
           else '11 (0.67+]' end as UBTI_bands,
       case
           when uw_fico < 680 then '01 <680'
           when uw_fico <= 719 then '02 680-719'
           when uw_fico <= 759 then '03 720-759'
           when uw_fico <= 799 then '04 760-799'
           else '05 800+' end    as fico_bands,
       case
           when gen3_score <= 660 then '01 <=660'
           when gen3_score <= 680 then '02 (660-680]'
           when gen3_score <= 700 then '03 (680-700]'
           when gen3_score <= 720 then '04 (700-720]'
           when gen3_score <= 740 then '05 (720-740]'
           else '06 740+' end    as gen3_score_bands,
       pl_use,
       tier
from (
         select *
         from base_data
             qualify row_number() over (partition by target_ID order by DATE_OF_UNDERWRITING) = 1);

/***************** Final *****************/

-- 5 min
create or replace table TDM_SANDBOX.SANDBOX.asd_2306_ubti as
select *
from (
         select af.ID
              , af.applicant_id
              , af.DW_APPLICATION_ID
              , di.UW_REQUEST_UUID
              , di.UW_RESULT_UUID
              , af.product_category
              , af.IS_PL_REFI_APP
              , af.APPLICATION_TYPE
              , af.COBORROWER_INDICATOR
              , af.DATE_START
              , af.INITIAL_DECISION
              , di.DATE_OF_UNDERWRITING
              , di.UW_RESULT:applicationDecisionInfo:plSlMember                                                           as plSlMember
              , try_cast(di.UW_REQUEST:application:initialRequestedLoanAmount::string as float)                           as initialRequestedLoanAmount
              , di.UW_RESULT:applicationDecisionInfo:tierSegment::string                                                  as tier_segment
              , case
                    when di.UW_RESULT:applicationDecisionInfo:decision::string = 'ACCEPT' then 1
                    else 0 end                                                                                            as qs_flag_actual
              , case
                    when di.UW_RESULT:applicationDecisionInfo:decision::string = 'ACCEPT' and
                         tier_segment = 'sofi_main' then 1
                    else 0 end                                                                                            as qs_flag_main
              , di.UW_RESULT:applicationDecisionInfo:applicationType::string                                              as app_type
              , di.uw_Result:applicationDecisionInfo
              , di.uw_Result:applicationDecisionInfo:sofiUbti::string                                                     as UBTI
              , lbd.ORIGINAL_PRIN
              , case
                    when di.UW_REQUEST:application:rateLockType::string = 'LIGHTBOX' then 1
                    else 0 end                                                                                            as lightbox_ind
              , case
                    when di.UW_REQUEST:application:rateLockType::string = 'DIRECT_MAIL' then 1
                    else 0 end                                                                                            as dm_ind
              , case
                    when lbd.CONFIRMED_FRAUD = 1 or cf.conf_fraud = 1 or fraud_atk.uid is not null then 1
                    else 0 end                                                                                            as fraud
              , try_cast(di.UW_RESULT:applicationDecisionInfo:individualDecisionInfos[0]:underwritingFico::string as int) as uw_fico_pri
              , di.UW_RESULT:workflowVersionUsed::string                                                                  as workflow_version_used
              , di.UW_REQUEST:creditBureauStrategy::string                                                                as creditBureauStrategy
              , try_cast(di.uw_Result:applicationDecisionInfo:combinedTierNumber::string as int)                          as initial_tier
              , di.uw_Request:application:applicantsList[0]:creditPull:tradelines                                         as tradelines
              , di.uw_Result:eligibility:uBTICalculations                                                                 as uBTICalculations
              , di.uw_Result:applicationDecisionInfo:projectedUbti                                                        as projectedUbti
              , try_cast(di.UW_RESULT:applicationDecisionInfo:individualDecisionInfos[0]:sofiNstl::string as float)       as sofiNstl
              , try_cast(di.UW_RESULT:applicationDecisionInfo:individualDecisionInfos[0]:sofiRvlv::string as float)       as sofiRvlv
              , try_cast(di.UW_RESULT:applicationDecisionInfo:individualDecisionInfos[0]:grossIncome::string as float)    as gross_income
              , lbd.tier
              , di.UW_REQUEST:application:applicantsList[0]:creditPull:tuCreditScoreModel:results::float                  as TU_FICO_1
              , di.UW_REQUEST:application:applicantsList[0]:creditPull:creditScores[0].score::float                       as Exp_FICO
              , UW_REQUEST:application:applicantsList[0]:creditPulls:TRANSUNION:creditScores:"00Q88".score::float         as TU_FICO
         from TDM_RISK_MGMT_HUB.MODELED.APPLICATIONS_FILE af
                  inner join TDM_UNDERWRITING.CLEANSED.DIODES_OFFICIAL di
                             on af.ID = di.TARGET_ID and di.TARGET_TYPE = 'APP'
                  left join TDM_RISK_MGMT_HUB.MODELED.LOANS_BLENDED_DAILY lbd on af.id = lbd.id
                  left join tdm_sandbox.sandbox.plmb_fraud_uid_list as fraud_atk on af.applicant_id = fraud_atk.uid
                  left join
              (select id
                    , max(case when activity_id = '1309' then 1 else 0 end) as conf_fraud
               from TDM_RISK_MGMT_HUB.MODELED.applications_file af
                        left join TDM_RISK_MGMT_HUB.MODELED.application_activity_facts aaf
                                  on af.dw_application_id = aaf.application_id
                        left join TDM_RISK_MGMT_HUB.MODELED.dates st_dt on aaf.active_date_id = st_dt.date_id
               where APPLICATION_TYPE = 'PL'
                 and af.DATE_DOC_UPLOAD >= '2022-01-01'
                 and af.DATE_DOC_UPLOAD < '2023-03-01'
                 and ACTIVITY_ID in ('1309')
               group by 1) as cf on af.id = cf.id
         WHERE af.date_start >= '2023-01-01'-- 09:11:00.000000000 -07:00' and '2023-06-16 10:29:00.000000000 -07:00' -- Outage
           and di.PRODUCT_NAME = 'PL'
           and (di.UW_RESULT['errors'][0] is null or
                di.UW_RESULT['errors'][0]['errorFactorKey'] != 'DECISIONING-API-ERROR')
           and (di.UW_REQUEST['creditBureauStrategy'] not in ('TRANSUNION'))
           and af.APPLICATION_TYPE = 'PL'
           and ((af.COBORROWER_INDICATOR = 'N' and app_type = 'Single') or
                (af.COBORROWER_INDICATOR = 'Y' and app_type = 'Joint'))
     )
    qualify row_number() over (partition by ID order by DATE_OF_UNDERWRITING) = 1;

select count(*)                                                                  as total,
       sum(case when coalesce(try_cast(ubti as float), 0) = 0 then 1 else 0 end) as UBTI_0,
       round(UBTI_0 * 100 / total, 1)                                            as pct
from TDM_SANDBOX.SANDBOX.asd_2306_ubti
where date_start between '2023-04-01' and '2023-06-30'
  and coalesce(lightbox_ind, 0) = 1;

select case
           when TRIM(UBTI) = '' OR coalesce(UBTI, 0) <= 0 then '01 Missing or 0'
           when UBTI <= 0.045 then '02 (0-0.045]'
           when UBTI <= 0.11 then '03 (0.045-0.11]'
           when UBTI <= 0.16 then '04 (0.11-0.16]'
           when UBTI <= 0.22 then '05 (0.16-0.22]'
           when UBTI <= 0.27 then '06 (0.22-0.27]'
           when UBTI <= 0.34 then '07 (0.27-0.34]'
           when UBTI <= 0.41 then '08 (0.34-0.41]'
           when UBTI <= 0.51 then '09 (0.41-0.51]'
           when UBTI <= 0.67 then '10 (0.51-0.67]'
           else '11 [0.67+)' end as UBTI
     , case
           when coalesce(uw_fico_pri, 0) < 300 then '01 <300'
           when coalesce(uw_fico_pri, 0) < 680 then '02 300-679'
           when coalesce(uw_fico_pri, 0) < 720 then '03 680-719'
           when coalesce(uw_fico_pri, 0) < 760 then '04 720-759'
           when coalesce(uw_fico_pri, 0) < 800 then '05 760-799'
           else '06 800+' end    as fico
     , count(*)                  as apps
from TDM_SANDBOX.SANDBOX.asd_2306_ubti
where date_start < '2023-04-01'
  and coalesce(lightbox_ind, 0) = 1
group by 1, 2;


-- Version used in LB
select case
           when di.UW_REQUEST:application:rateLockType::string = 'LIGHTBOX' then 1
           else 0 end                           as lightbox_ind
     , case
           when di.UW_RESULT:applicationDecisionInfo:fcf:versionUsed::string = 'v3'
               then 'V3'
           else 'Other' end                     as FCF_versionUsed
     , di.UW_RESULT:workflowVersionUsed::string as workflow_version_used

     , count(distinct TARGET_ID)                as apps
     , max(DATE_OF_UNDERWRITING)                as latest_DATE_OF_UNDERWRITING
from TDM_UNDERWRITING.CLEANSED.DIODES_OFFICIAL di
WHERE DATE_OF_UNDERWRITING >= '2023-05-01'
  and PRODUCT_NAME = 'PL'
  and (UW_RESULT['errors'][0] is null
    or UW_RESULT['errors'][0]['errorFactorKey'] != 'DECISIONING-API-ERROR')
  and (di.UW_REQUEST['creditBureauStrategy'] not in ('TRANSUNION'))
--and WORKFLOW_VERSION_USED='16.1'
group by 1, 2, 3
order by 1, 2, 3;


show columns on TDM_RISK_MGMT_HUB.MODELED.applications_file;

select *
from TDM_UNDERWRITING.CLEANSED.DIODES_OFFICIAL di
WHERE DATE_OF_UNDERWRITING >= '2023-05-01'
  and PRODUCT_NAME = 'PL'
  and (UW_RESULT['errors'][0] is null
    or UW_RESULT['errors'][0]['errorFactorKey'] != 'DECISIONING-API-ERROR')
  and (di.UW_REQUEST['creditBureauStrategy'] not in ('TRANSUNION'))
  and di.UW_REQUEST:application:rateLockType::string = 'LIGHTBOX';

select case
           when TRIM(UBTI) = '' OR coalesce(UBTI, 0) <= 0 then '01 Missing or 0'
           when UBTI <= 0.045 then '02 (0-0.045]'
           when UBTI <= 0.11 then '03 (0.045-0.11]'
           when UBTI <= 0.16 then '04 (0.11-0.16]'
           when UBTI <= 0.22 then '05 (0.16-0.22]'
           when UBTI <= 0.27 then '06 (0.22-0.27]'
           when UBTI <= 0.34 then '07 (0.27-0.34]'
           when UBTI <= 0.41 then '08 (0.34-0.41]'
           when UBTI <= 0.51 then '09 (0.41-0.51]'
           when UBTI <= 0.67 then '10 (0.51-0.67]'
           else '11 [0.67+)' end as UBTI
     , case
           when coalesce(uw_fico_pri, 0) < 300 then '01 <300'
           when coalesce(uw_fico_pri, 0) < 680 then '02 300-679'
           when coalesce(uw_fico_pri, 0) < 720 then '03 680-719'
           when coalesce(uw_fico_pri, 0) < 760 then '04 720-759'
           when coalesce(uw_fico_pri, 0) < 800 then '05 760-799'
           else '06 800+' end    as fico
     , count(*)                  as apps
from TDM_SANDBOX.SANDBOX.asd_2306_ubti
where date_start between '2023-05-01' and '2023-05-31'
  and coalesce(lightbox_ind, 0) = 1
group by 1, 2;
--28/24977=1.14% UBTI=0


select date_start
from TDM_SANDBOX.SANDBOX.asd_2306_ubti
where id in (15912879, 16252052, 15865972)

select IS_PL_REFI_APP, count(*)
from TDM_SANDBOX.SANDBOX.asd_2306_ubti
group by 1;

select count(*), count(*) - count(distinct id) as dup
from TDM_SANDBOX.SANDBOX.asd_2306_ubti;

/*
create or replace table TDM_SANDBOX.SANDBOX.asd_2306_ubti_clicks as
select A.*, B.model_id, B.LB_AMOUNT, B.LB_LOAN_PURPOSE, B.term, B.APR
from TDM_AFFILIATES.SUMMARIZED.AFFILIATES_APPLICATION_FILE A
         LEFT JOIN TDM_AFFILIATES.AFFILIATES.AFFILIATE_CLICK B
                   ON a.click_id = b.click_id and a.click_date = b.click_date and a.click_id is not null
where A.ad_name in (
                    'Credit Karma - Personal Loan - Redirect - Lightbox',
                    'Credit Karma - PL - Redirect - Lightbox')
  and A.click_date >= '2022-01-01'
  and A.product = 'PERSONAL_LOAN'
  and a.click_id is not null;
*/

create or replace table TDM_SANDBOX.SANDBOX.asd_2306_easynoeasyLB3 as (

-- ea
    with ea as (select distinct party_id
                              , sofi_id
                              , ea.click_id
                              , ac.click_date
                              , revenue_id                  as cktrackingid
                              , coalesce(ac.ad_id, 1639168) as ad_id
                              , 1                           as isEasyApply
                from tdm_affiliates.cleansed.affiliate_personal_loan_lead_easy_apply ea
                         left join tdm_affiliates.modeled.affiliate_click_modeled ac
                                   on ea.click_id = ac.click_id
                where is_test_user = 'FALSE'
                  AND applied_date between '2023-04-01' and '2023-06-30'
                  AND status not in ('E', 'R', 'N')
                    qualify row_number() OVER (PARTITION BY sofi_id order by click_date desc) = 1
    ),

--non ea lb
         non_ea as (
             select distinct party_id
                           , app_id
                           , ac.click_id
                           , ac.click_date
                           , shared_id as cktrackingid
                           , ac.ad_id
                           , 0         as isEasyApply
             from tdm_affiliates.modeled.post_back_modeled pb
                      left join tdm_affiliates.modeled.affiliate_click_modeled ac
                                on pb.click_id = ac.click_id
             where pb.PARTNER_ID IN ('1429719', '156490')
               AND pb.PRODUCT = 'PERSONAL_LOAN'
               AND pb.APP_ID IS NOT NULL
               AND ac.click_date between '2023-04-01' and '2023-06-30'
               AND app_id not in (select sofi_id from ea)
                 qualify row_number() OVER (PARTITION BY APP_ID order by click_date desc) = 1
         ),

         combined as (
             select *
             from non_ea
             union
             select *
             from ea)

    select *
    from combined);

select count(*),
       count(*) - count(distinct app_id),
       count(*) - count(distinct CKTRACKINGID),
       count(*) - count(distinct CLICK_ID),
       count(*) - count(distinct ad_id)
from TDM_SANDBOX.SANDBOX.asd_2306_easynoeasyLB3;

--8242 out of 9135 for May
--52045 out of 59695
select count(*)
from TDM_SANDBOX.SANDBOX.asd_2306_ubti
where date_start between '2023-04-01' and '2023-06-30'
  and coalesce(lightbox_ind, 0) = 1
  --and (coalesce(try_cast(UBTI as float), 0) <= 0.22)
  and APP_TYPE = 'Single'
  and IS_PL_REFI_APP is null
  and cast(id as string) in (select distinct app_id from TDM_SANDBOX.SANDBOX.asd_2306_easynoeasyLB3);

select WORKFLOW_VERSION_USED, count(*)
from TDM_SANDBOX.SANDBOX.asd_2306_ubti
where date_start between '2023-04-01' and '2023-06-30'
  and coalesce(lightbox_ind, 0) = 1
  --and (coalesce(try_cast(UBTI as float), 0) <= 0.22)
  and APP_TYPE = 'Single'
  and IS_PL_REFI_APP is null
  and cast(id as string) in (select distinct app_id from TDM_SANDBOX.SANDBOX.asd_2306_easynoeasyLB3)
group by 1
order by 1;

create or replace table TDM_SANDBOX.SANDBOX.asd_2306_ubti_sample3 as
select a.id
     , b.tracking_id
     , date_start
     , b.CLICK_DATE
     , TRADELINES
     , sofinstl
     , sofirvlv
     , gross_income
     , UBTI
     , uw_fico_pri as FICO
     --,(coalesce(try_cast(sofinstl as float),0)+coalesce(try_cast(sofirvlv as float),0))/gross_income as UBTI_sim ,round(abs(UBTI_sim-UBTI),2) as dif
     --, UW_REQUEST_UUID
     --, UW_RESULT_UUID
     --, DATE_OF_UNDERWRITING
from TDM_SANDBOX.SANDBOX.asd_2306_ubti a
         inner join (
    select app_id as id, max(CKTRACKINGID) as tracking_id, max(CLICK_DATE) as CLICK_DATE
    from (
             select app_id, CLICK_DATE, CKTRACKINGID
             from TDM_SANDBOX.SANDBOX.asd_2306_easynoeasyLB3
             where CKTRACKINGID is not null
                 qualify row_number() over (partition by app_ID order by CLICK_DATE desc) = 1
         )
    group by 1
) b on cast(a.id as string) = b.id
where date_start between '2023-04-01' and '2023-06-30'
  and coalesce(lightbox_ind, 0) = 1
  --and (coalesce(try_cast(UBTI as float), 0) <= 0.22)
  and APP_TYPE = 'Single'
  and IS_PL_REFI_APP is null;
--and coalesce(try_cast(gross_income as float), 0) > 0
--and dif > 0
--limit 1000;

select count(*)                               as total,
       count(*) - count(distinct id)          as dup_id,
       count(*) - count(distinct tracking_id) as dup_track
from TDM_SANDBOX.SANDBOX.asd_2306_ubti_sample3;

select *
from TDM_SANDBOX.SANDBOX.asd_2306_ubti_sample
where tracking_id in (
    select tracking_id
    from TDM_SANDBOX.SANDBOX.asd_2306_ubti_sample
    group by 1
    having count(*) > 1)
order by TRACKING_ID;

select case
           when TRIM(UBTI) = '' OR coalesce(UBTI, 0) <= 0 then '01 Missing or 0'
           when UBTI <= 0.045 then '02 (0-0.045]'
           when UBTI <= 0.11 then '03 (0.045-0.11]'
           when UBTI <= 0.16 then '04 (0.11-0.16]'
           when UBTI <= 0.22 then '05 (0.16-0.22]'
           when UBTI <= 0.27 then '06 (0.22-0.27]'
           when UBTI <= 0.34 then '07 (0.27-0.34]'
           when UBTI <= 0.41 then '08 (0.34-0.41]'
           when UBTI <= 0.51 then '09 (0.41-0.51]'
           when UBTI <= 0.67 then '10 (0.51-0.67]'
           else '11 [0.67+)' end as UBTI
     , case
           when coalesce(FICO, 0) < 300 then '01 <300'
           when coalesce(FICO, 0) < 680 then '02 300-679'
           when coalesce(FICO, 0) < 720 then '03 680-719'
           when coalesce(FICO, 0) < 760 then '04 720-759'
           when coalesce(FICO, 0) < 800 then '05 760-799'
           else '06 800+' end    as fico
     , count(*)                  as apps
from TDM_SANDBOX.SANDBOX.asd_2306_ubti_sample
group by 1, 2;

select count(*),
       count(distinct TRACKING_ID),
       min(least(DATE_START)),
       max(greatest(DATE_START)),
       min(least(DATE_START, CLICK_DATE)),
       max(greatest(DATE_START, CLICK_DATE))
from (
         select *
         from (
                  select TRACKING_ID,
                         id,
                         DATE_START,
                         cast(CLICK_DATE as date) as CLICK_DATE,
                         SOFINSTL,
                         SOFIRVLV,
                         GROSS_INCOME,
                         UBTI,
                         fico
                  from TDM_SANDBOX.SANDBOX.asd_2306_ubti_sample3
                  --where DATE_START between '2023-05-24' and '2023-05-31' and CLICK_DATE between '2023-05-24' and '2023-05-31'
              ) a
             qualify row_number() over (partition by TRACKING_ID order by id desc) = 1
     ) a;

-- Output to MBE's input
--Apr_May_Jun_file_latest
select TRACKING_ID,
       id                             as id_back,
       extract(month from DATE_START) as month_date_start_back,
       --cast(CLICK_DATE as date) as click_date_back,
       SOFINSTL                       as SOFINSTL_back,
       SOFIRVLV                       as SOFIRVLV_back,
       GROSS_INCOME                   as GROSS_INCOME_back,
       UBTI                           as UBTI_back,
       fico                           as fico_back
       --tradelines
from TDM_SANDBOX.SANDBOX.asd_2306_ubti_sample3
    qualify row_number() over (partition by TRACKING_ID order by id desc) = 1;

--468/49727
select count(*)
from (
         select *
         from TDM_SANDBOX.SANDBOX.asd_2306_ubti_sample3
         where coalesce(try_cast(UBTI as float), 0) = 0
             qualify row_number() over (partition by TRACKING_ID order by id desc) = 1);


select round(((select count(*)
               from (
                        select *
                        from TDM_SANDBOX.SANDBOX.asd_2306_ubti_sample3
                            qualify row_number() over (partition by TRACKING_ID order by id desc) = 1)
               where coalesce(try_cast(UBTI as float), 0) = 0) / (select count(*)
                                                                  from (
                                                                           select *
                                                                           from TDM_SANDBOX.SANDBOX.asd_2306_ubti_sample3
                                                                               qualify row_number() over (partition by TRACKING_ID order by id desc) = 1))
    * 100), 2) as pct_ubti_0;

select avg(coalesce(try_cast(SOFIRVLV as float), 0))
from (
         select *
         from TDM_SANDBOX.SANDBOX.asd_2306_ubti_sample3
             qualify row_number() over (partition by TRACKING_ID order by id desc) = 1)

select id as id_back,TRADELINES
from TDM_SANDBOX.SANDBOX.asd_2306_ubti_sample3
where id in ('24693082',	'24588631',	'24347270',	'24257395',	'23168735',	'23042033',	'23694942',	'23555690',	'23602130',	'23880137',	'22951703',	'24534190',	'23172443',	'23410255',	'23057990',	'22991832',	'23439998',	'24030498',	'24170316',	'24512224',	'23736558',	'24377440',	'23325419',	'23976031',	'22835440',	'24606742',	'24375162',	'24203151',	'22881820',	'23272183',	'24772997',	'23986116',	'23803265',	'24821923',	'23793416',	'22923406',	'24591402',	'24371254',	'23370610',	'23950983',	'23291914',	'23782012',	'24488147',	'23742010',	'23060951',	'23109380',	'23521022',	'24071094',	'24159042',	'24089979',	'24812040',	'23438100',	'23941656',	'23132780',	'23346894',	'23397682',	'23398015',	'22923131',	'23278792',	'23659739',	'23252465',	'24768667',	'23231906',	'24494187',	'24349178',	'23787212',	'24230510',	'23116312',	'23687733',	'23954049',	'24141531',	'23936601',	'24246150',	'23702686',	'23923334',	'22965098',	'23068884',	'23353074',	'23271322',	'24779651',	'24208360',	'23211855',	'24177905',	'24065747',	'23810229',	'23633968',	'23526268',	'22929206',	'23775275',	'23038830',	'23036971',	'23405007',	'23166657',	'22839469',	'23324201',	'24002572',	'24777610',	'23130669',	'24617941',	'24167635',	'24124784',	'23113883',	'23758082',	'23544376',	'23328092',	'24817593',	'23401993',	'23476251',	'23231030',	'23104210',	'22914612',	'24253372',	'22840310',	'23523584',	'23518794',	'23289684',	'23176384',	'23313513',	'24192297',	'24782934',	'24424812',	'23725927',	'23760181',	'22986807',	'23269904',	'24732404',	'24249976',	'23236318',	'23692780',	'22976655',	'22977739',	'22953647',	'23543819',	'23165407',	'23359454',	'24230070',	'23466012',	'23250245',	'23408396',	'23813714',	'23779734',	'23879258',	'23254164',	'24061466',	'24084421',	'24064928',	'23538830',	'22984610',	'24225086',	'23249731',	'23230307',	'23552064',	'23037059',	'23359738',	'24202509',	'23826940',	'23584057',	'24802483',	'24100005',	'23190885',	'23221639',	'23993262',	'24156521',	'23310236',	'23200306',	'23582484',	'24741933',	'23303759',	'22956605',	'22967464',	'23175569',	'24778192',	'23103679',	'23167951',	'24028248',	'24402358',	'23749720',	'24581640',	'24094970',	'23686214',	'24601751',	'23024180',	'24591802',	'24486687',	'24407922',	'23408636',	'24786297',	'24456451',	'23214079',	'23350354',	'23099115',	'24417199',	'23762360',	'23276024',	'23262336',	'24338896',	'23009066',	'23583002',	'23183355',	'22879293');

create or replace table tdm_sandbox.sandbox.asd_2306_ubti_sample3_output(ck_impression_id string,	ID_BACK string,	revolving_bal_back float,	revolving_bal_front string);

insert into tdm_sandbox.sandbox.asd_2306_ubti_sample3_output(ck_impression_id, ID_BACK,revolving_bal_back,revolving_bal_front)
values
 ('a428763a-4901-4153-aefa-8d7ddc550132',24693082,1899,'NaN')
,('9a4a66b5-85ec-4d9c-80d0-e5101c623bd6',24588631,21696,'NaN')
,('9dcfd553-310c-4e1f-9d46-f5e0841f9415',24347270,4261,'0')
,('28468b2c-482a-4324-bbd9-79176c864bb3',24257395,72,'0')
,('becdff1f-1cdc-441e-a364-6afc37e0d51e',23168735,40799,'NaN')
,('feaf19d2-c042-487f-b36b-2c8dd093780a',23042033,5232,'NaN')
,('31443c46-5b26-48fe-b193-df2bd9113e57',23694942,6358,'NaN')
,('a66bfe7c-5215-40fc-9ba1-d8a4795333b0',23555690,29443,'NaN')
,('af565948-48ac-43a1-a0f6-a2019687ddd7',23602130,4461,'0')
,('54235242-b0ec-42a3-89c3-202b9f1aedf4',23880137,6762,'NaN')
,('6937b875-ab0c-4b00-bd66-3ff8bb755163',22951703,21065,'NaN')
,('79d0430f-4ec1-4bc6-a770-3403a0e71b08',24534190,1628,'NaN')
,('b190c877-0ab5-4ffd-8bdd-db228bc0db13',23172443,6462,'NaN')
,('29ebcf32-2b0e-4810-8224-889c427ea036',23410255,3379,'NaN')
,('1d1aa7b8-e398-461e-b224-f208055ae4ed',23057990,11022,'NaN')
,('e7202276-8d7a-4068-af0c-ef645254fb1e',22991832,304,'0')
,('81f0703b-7ffe-4c6f-a098-31be1be3d32c',23439998,29365,'NaN')
,('a0469971-4bc1-4b45-afab-0f1ab8868e01',24030498,20809,'NaN')
,('d4fbd294-9ce2-41fa-977d-6a5860552087',24170316,10042,'NaN')
,('92354135-8ce1-47b7-a0d8-8e88277b4404',24512224,5078,'NaN')
,('90e0f7b1-5eb7-408e-b2bc-abf9e1a0de6f',23736558,18776,'NaN')
,('5bc04465-7956-43fc-b912-439bae2d1adb',24377440,9691,'NaN')
,('d28d978d-5539-47ba-81b7-c32916ef6ea5',23325419,301,'0')
,('a6b23876-6ce9-4a90-b64f-08ad4e468c3c',23976031,27280,'0')
,('316da89c-45a0-4ec3-9e9b-ea227e370112',22835440,24684,'0')
,('2920d26b-4185-4405-8dce-49232c9558a6',24606742,2785,'NaN')
,('030b6a62-97aa-484a-b0af-23e3b548cafc',24375162,44492,'0')
,('2e5ae60a-9b30-4f74-be93-d9004543f9f0',24203151,18179,'NaN')
,('87f4c2d9-cc4b-48f3-966b-48f5231ab913',22881820,6585,'0')
,('494453aa-a179-4c9e-80ad-f4f8e2c9ff82',23272183,7149,'NaN')
,('04b6d500-0b14-4af1-8cb4-636e61e74165',24772997,19366,'NaN')
,('a75f9d41-7fc1-437d-836c-c3c3797b87c3',23986116,18013,'0')
,('ca9a7091-a96c-4933-960f-3dff9324935f',23803265,2757,'NaN')
,('7a7f7ab5-ead9-4cd1-98dc-c92b71ec7f14',24821923,10327,'NaN')
,('d8d66e49-f26f-4d18-94cf-d35cec638bbd',23793416,32767,'NaN')
,('b077919a-6c05-4876-83f1-ffc0880be645',22923406,83040,'NaN')
,('dd03854f-264a-47e1-abfc-b782e942ba40',24591402,30756,'NaN')
,('12b0df0a-9810-4aba-a12a-4f87a77f05cb',24371254,19673,'NaN')
,('5b9037fe-aafb-4a47-a3af-1ba6c0fb5528',23370610,23022,'NaN')
,('fc90d101-9fa4-490b-9f51-7354a09c5af1',23950983,25544,'0')
,('be0c4665-b0b0-4536-900f-719d3204fd8d',23291914,11900,'NaN')
,('b58aee90-f5ae-43c3-8a89-95e57a7e7ad1',23782012,32080,'0')
,('b08cf290-0894-4b75-84ef-3f460c1a3da0',24488147,823,'0')
,('aaafbdfb-e019-4f9b-9fa5-402a3a64a353',23742010,33789,'NaN')
,('5e28de1a-1a1a-4baa-8eab-e73fd148ae14',23060951,59924,'0')
,('11e20b51-e0a2-4fca-938f-350aebcbb399',23109380,15953,'0')
,('159ca62c-f8a0-4e7d-acaa-08e8d88a16ea',23521022,26621,'NaN')
,('31f5851c-4c07-425b-b032-194880dba747',24071094,382,'NaN')
,('7b992b71-9a8e-477f-b641-037344dd36b3',24159042,64323,'NaN')
,('8adf5339-0bfc-43d1-b490-6289ce60ffb8',24089979,11081,'0')
,('73b1ae51-0210-4f81-a582-06622b591f61',24812040,45344,'NaN')
,('6390a01e-bef9-4fd7-b312-34fc0b911a7a',23438100,3625,'NaN')
,('7372ab7c-f595-4d75-b9b8-c295305b3795',23941656,45307,'NaN')
,('dcd6ec46-e794-422a-8480-3d2a7ea4a690',23132780,4672,'NaN')
,('8ef8d75f-6dc1-42c4-82d1-94e464481349',23346894,22125,'0')
,('728a72f8-a668-400b-954b-c81a08e00694',23397682,38977,'NaN')
,('38c93520-6c72-4982-8e2e-a58df7cc1a30',23398015,17741,'NaN')
,('19b07c35-f311-413a-96e1-fbeced5b3c9b',22923131,9945,'NaN')
,('ef6cbd81-0c14-4581-b022-ffceacde0daf',23278792,11485,'NaN')
,('e69e5a4e-9ecf-4971-8fed-650dae83c321',23659739,7804,'NaN')
,('82295243-b7ac-4925-a6a1-9c13100b5017',23252465,3347,'NaN')
,('30a2d3aa-1cb6-42e2-ac6a-da44c5884735',24768667,3413,'NaN')
,('86395780-e87d-403a-8e8f-32033c507569',23231906,4609,'NaN')
,('ed01d688-fd4d-4894-bdb7-2e820caae23d',24494187,71534,'NaN')
,('5407766f-15cc-4a97-b8d1-f474e1699890',24349178,5676,'0')
,('7fb957e9-6c16-4c4b-b41b-a331c77671b2',23787212,877,'0')
,('7883a0c0-f537-452b-b910-a86f27690ccd',24230510,20427,'NaN')
,('18e2f45a-dedb-45c2-b2b9-05ea76e95dcb',23116312,41177,'0')
,('22a785d3-3919-44a9-93a4-77e008486ad6',23687733,32040,'NaN')
,('af851301-cac5-4334-9b52-7519398ebccb',23954049,33236,'0')
,('4f9146b6-dc43-424a-8319-2182205ccd0b',24141531,12155,'NaN')
,('1aa57276-125c-4683-abf6-2968d9427f93',23936601,41249,'NaN')
,('ce4d2ba7-0828-4ac0-adf7-f11e7c2007fb',24246150,77569,'NaN')
,('78470438-cf10-4f2e-a60c-a7eeff0d5990',23702686,6007,'NaN')
,('9a4b3dd9-32dc-42ca-9bcf-6ba75737d7a5',23923334,9013,'0')
,('639c6b3c-f6a3-4f16-9d17-ca1514c977d1',22965098,2120,'0')
,('0821ad94-aad5-4562-a941-0ab13aca8e76',23068884,17,'0')
,('f0e020a8-81e8-4922-a5c2-a253a1175297',23353074,11707,'NaN')
,('7c1388f3-61d6-4321-ac72-7b2d3f113bae',23271322,1445,'NaN')
,('106e5f6c-8daf-43dc-bff8-8d57d3e9106c',24779651,5343,'NaN')
,('34ccae0e-4094-4737-ae06-4edfdd2248e3',24208360,10060,'NaN')
,('0383ca90-a9d6-4446-9362-0d0f3f48ec04',23211855,19069,'NaN')
,('2fe816c5-f350-4131-8630-e78505aa179b',24177905,4186,'0')
,('3d68bef9-5c29-4e82-b860-12c967dc2b9c',24065747,2177,'NaN')
,('3e763ffc-5d2c-45e5-9090-35508707be3a',23810229,4420,'NaN')
,('b0990dba-fa74-49a8-9aa1-93bbde2a456f',23633968,25303,'NaN')
,('58969483-0e19-4b17-804c-683b318e195b',23526268,415,'0')
,('6fd45a00-d363-4d94-b5fa-22a996e1bf49',22929206,8938,'0')
,('c0b1f455-9fab-420c-a29e-e7d4b1817549',23775275,1235,'NaN')
,('7c1f5569-e40c-41ad-be9f-fb30e96baf98',23038830,16692,'NaN')
,('e351eaea-55b6-42bd-bf24-d852d1f782cc',23036971,15074,'0')
,('3906261c-a378-48f9-bf92-71de4266712c',23405007,29777,'0')
,('13c16dfc-20fe-4734-a852-21c57e75412d',23166657,548,'0')
,('ec6a9a82-7550-4fa4-a7ad-adb6bcb24aec',22839469,6125,'0')
,('254c8a76-28b9-4c62-b15e-9f869e6dda06',23324201,11734,'NaN')
,('bec1dfe3-1e16-4f4c-a7d3-8278deb10403',24002572,22773,'0')
,('693e1a86-757d-4f37-bac5-948d9e80f096',24777610,32961,'NaN')
,('280095a3-545d-4732-baaa-c21583711f0c',23130669,14831,'NaN')
,('cb6aa2eb-cc0f-4115-b338-575e08635146',24617941,779,'NaN')
,('e7046c5b-db2e-4a1a-990b-269475069297',24167635,6490,'NaN')
,('e1d420cf-0598-4213-ad3e-7d98b3c2f29c',24124784,2059,'NaN')
,('dc23ac24-1756-4e00-97ca-e20a91040441',23113883,16551,'NaN')
,('b07f2988-fdcc-4bfd-afe6-545c33c7e92a',23758082,578,'0')
,('c25e2242-f39c-4268-b156-9ac4c4a02e41',23544376,11210,'0')
,('1b87d2a8-110d-4e9d-aa96-7d6ffa4f368b',23328092,11322,'NaN')
,('18357ff0-4dcb-4fd8-8b66-65e5a3458ba2',24817593,4523,'NaN')
,('3db68941-635b-4561-a5bf-7776bb993bf0',23401993,13163,'0')
,('b6d20c54-17f1-45ff-87a7-87d8652a087e',23476251,495,'0')
,('580a4207-eae0-4a25-8b32-2ef56f8b8ddb',23231030,61090,'NaN')
,('3ffbb328-f949-4e5a-8021-474d61ef8eb8',23104210,19275,'NaN')
,('b9abd402-47cc-48d7-abab-4b62ae448b77',22914612,4210,'NaN')
,('05016b24-a9b8-49fc-9835-4bc97d6fcc70',24253372,17764,'NaN')
,('7ff5c62c-175d-41d0-b914-452b595aa751',22840310,6860,'NaN')
,('b095c642-0312-41bf-9cf2-f6d17104e3e2',23523584,13698,'NaN')
,('e9b4c531-654a-4355-9d07-1bbc1222442b',23518794,10980,'NaN')
,('0d0a2832-82ad-42c7-bd37-ca8672307b37',23289684,17972,'0')
,('1019071a-71ea-486d-b0e1-87ec47af73c9',23176384,6239,'NaN')
,('25484401-8a58-454e-88bc-3e59b6b6b867',23313513,6507,'NaN')
,('1a01ca5c-2e68-4eaf-ae3f-998a05f5878e',24192297,3158,'NaN')
,('42ec9efa-9365-4952-8384-c83cfe3f58c3',24782934,7901,'NaN')
,('4be89339-8ad4-4d70-b653-02e583bb772c',24424812,17808,'NaN')
,('b21ff80a-b0bb-44e6-9b4b-d3a2a36584e5',23725927,55,'0')
,('ab50d38e-2548-4051-a33f-1e5d855cf2b6',23760181,17957,'NaN')
,('dd778ae1-6321-4df1-a8d4-fb97648fb573',22986807,7579,'0')
,('6957c3a1-f714-4e19-88d8-0468257a09c0',23269904,11868,'NaN')
,('fc656f70-90b1-4174-87e4-b8d2fb71e7b2',24732404,78320,'0')
,('76a3eae7-0011-49f6-867a-4928f480e8c9',24249976,179,'NaN')
,('3fda0b59-ae36-48c0-9c47-28c1463a2337',23236318,17954,'NaN')
,('94cda6dd-44a9-4d52-991e-f47c56d9a4fb',23692780,18249,'NaN')
,('7abaf557-e299-4970-814e-efdd1ec14774',22976655,37350,'NaN')
,('de7891c4-cc66-45ee-a582-0bc5a24a4431',22977739,15296,'NaN')
,('c3fd7bb8-b5ed-4958-980e-f561e55e5e99',22953647,10444,'NaN')
,('9c0309e6-c393-4011-ba43-e79ab7944dce',23543819,7888,'NaN')
,('3bd445a7-9bc8-40e6-acf8-f770eec90721',23165407,22132,'NaN')
,('f48c6ec9-06a7-4d10-bfde-959bb23545be',23359454,42554,'NaN')
,('330721e3-6005-4c8c-aee5-d029e8af54c3',24230070,8942,'NaN')
,('f42f1337-1c76-491c-9fd1-1c0a0d3c385f',23466012,20313,'0')
,('e5ffbbb9-4272-4db8-a0ca-5b7ef2ad7b23',23250245,8069,'NaN')
,('8987236e-5f78-42fa-93f2-8a963e78c36e',23408396,4100,'NaN')
,('31a9d7ff-0611-4bc9-b05c-f3684ed009bb',23813714,7263,'0')
,('7060d537-20dd-48d6-85f4-5f8b5dbda380',23779734,2267,'NaN')
,('6001cda1-ea48-4df7-bb04-1715f14bf00e',23879258,1,'NaN')
,('08b31531-fc82-464d-91ae-a1e51241f0b4',23254164,22410,'NaN')
,('e0981a14-70ad-43a8-b68b-c1a0ab943c68',24061466,55293,'NaN')
,('04a89941-4b10-485c-97f2-37c1f442b0fc',24084421,5065,'NaN')
,('ca513e2d-1d7b-4e3c-8c55-961f6471a9ae',24064928,21512,'NaN')
,('47c78249-8916-4d1d-a43a-5f6257519f86',23538830,16288,'NaN')
,('286066d0-c356-4c41-86e8-40fe7e3ff0cc',22984610,55094,'NaN')
,('592244f6-8bc5-430a-ada7-21c3a6dbcb1d',24225086,10519,'NaN')
,('c3d32202-558b-4cd5-b756-4785939bb178',23249731,14874,'NaN')
,('b6fd8f2e-e829-4a16-9cb7-faa7363703cf',23230307,24694,'NaN')
,('9332a028-7bc6-4004-9990-ff070f46abb1',23552064,12160,'NaN')
,('f6749235-1990-483b-924b-f880f8fa09c4',23037059,5916,'0')
,('52cbc8cf-646a-4ae9-958a-0b2c51c2662d',23359738,27215,'NaN')
,('ee0d2c1f-004d-4429-b40d-e158ad5eca20',24202509,19793,'NaN')
,('107719a1-46c6-403e-864e-44c747579d90',23826940,5125,'0')
,('4cde8b73-05db-4c97-bb14-468853ab2a5d',23584057,5935,'0')
,('d82902ab-d299-4eed-8e13-a0921fa40859',24802483,55274,'NaN')
,('96d37bff-1b60-4b14-a391-5596eeaeb50c',24100005,24979,'0')
,('0456e759-1803-4760-a12e-f6de75ffd4d1',23190885,5388,'0')
,('7c42a587-8387-4963-a907-3d4bfa372a51',23221639,60701,'NaN')
,('3c717aec-ba15-4b0b-b587-c39c1a75ebdb',23993262,115,'0')
,('12a897a8-3c88-4af1-a1ce-f0dcf504a121',24156521,22426,'0')
,('4376816f-7ff9-4856-9b16-5504a4ae3f00',23310236,4442,'0')
,('58acbcec-88f7-4302-af5c-a5f9a12b787e',23200306,2513,'0')
,('aaa9a175-e762-4d3f-9a07-67a98a726b15',23582484,19221,'NaN')
,('20c87a97-4542-469e-8606-aff83c2a50d7',24741933,33517,'0')
,('e119cd43-4b32-4908-aba3-b4d22251b2c8',23303759,14775,'NaN')
,('da386961-d43c-4233-9f04-1c8735d8ccf9',22956605,4119,'NaN')
,('edb3595a-3749-47a8-9ac5-437c266ba543',22967464,21336,'NaN')
,('19519e48-7242-4684-b2a3-45773f6f7de2',23175569,477,'0')
,('16137cb3-68c4-4d0b-831b-d05ca2f1e3c8',24778192,10657,'NaN')
,('7b56e601-32d4-46db-8e7b-caf3f2437c58',23103679,12700,'NaN')
,('6dc85382-93c4-4b52-8db8-a44411980e5f',23167951,3913,'NaN')
,('3381e115-054d-491a-b79f-e3ff3340f764',24028248,4410,'0')
,('6cf5911a-36e3-4f1b-881f-6f43f8da5f5c',24402358,4367,'NaN')
,('f222ed1c-e4eb-4b39-9994-79f6299cb13a',23749720,97063,'NaN')
,('245567bc-d9be-49b4-831c-0d6989082566',24581640,8940,'0')
,('17e82263-a1bc-413c-b9bb-f84a38d06577',24094970,11791,'NaN')
,('a728f8fe-bc90-46a5-9224-0c6656757a03',23686214,196,'0')
,('a18b188d-8555-44df-af14-7b4a9b340fbf',24601751,34690,'NaN')
,('716e4ee9-483f-40c2-86be-62cbee189c2e',23024180,44574,'NaN')
,('377b7dae-c614-4902-a767-17e865754ca5',24591802,37609,'NaN')
,('b372799b-538b-4cd6-8db3-ce5459005377',24486687,93010,'NaN')
,('3d587e2f-715b-40d2-bcf0-185508ea34dd',24407922,61541,'NaN')
,('eb109f53-49b9-4ba9-8b24-f38c60f6f379',23408636,1049,'0')
,('1133c586-abb7-4dbd-bba0-16fc63ed1f86',24786297,46255,'NaN')
,('71812d6e-14ec-4dfd-a260-f5a3c9123ec5',24456451,14122,'0')
,('fbbc74da-b23d-4092-91c6-d0f0e8f46e1e',23214079,14979,'0')
,('55c70db2-0259-4c0e-983d-f09bf1095fb9',23350354,14376,'NaN')
,('98ca50bc-1194-441d-88a2-ec5ebf0b2a79',23099115,10956,'NaN')
,('3d9718c8-fdd3-43e6-8f82-06798a33a94d',24417199,15367,'0')
,('16e7c94e-cd4a-430c-b2a1-c7bcadc55a92',23762360,29033,'NaN')
,('060fdd6f-056a-4086-ab20-51f1df8dfd88',23276024,56604,'NaN')
,('59e386a6-13b5-469e-be86-98be1afc6de9',23262336,74054,'NaN')
,('f61ccd91-032b-48e3-8ac5-bc5e81966879',24338896,50579,'NaN')
,('c33bf28c-d208-434a-a607-7487363ca005',23009066,31211,'NaN')
,('3afe419f-3401-4450-8c2c-11ce3495057c',23583002,14876,'NaN')
,('8f4daa68-f883-416f-9e38-1fedfcc87431',23183355,2148,'0')
,('9599d60b-6b6e-49dc-87b1-6453fef8f580',22879293,5066,'0');

select a.*, b.SOFIRVLV
from tdm_sandbox.sandbox.asd_2306_ubti_sample3_output a
         inner join tdm_sandbox.sandbox.asd_2306_ubti_sample3 b on a.ID_BACK = b.id
where a.revolving_bal_back <> b.SOFIRVLV;

select a.CK_IMPRESSION_ID,a.REVOLVING_BAL_BACK as REVOLVING_BAL_BACKEND,a.REVOLVING_BAL_FRONT as REVOLVING_BAL_FRONTEND, b.TRADELINES as TRADELINES_BACKEND
from tdm_sandbox.sandbox.asd_2306_ubti_sample3_output a
         inner join tdm_sandbox.sandbox.asd_2306_ubti_sample3 b on a.ID_BACK = b.id;
